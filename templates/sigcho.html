<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>De VHDL a Silicio: Arquitectura de Computadores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Chosen Palette: Tech Neutral & Silicon Blue */
        /* Background: bg-slate-50 */
        /* Text: text-slate-800 */
        /* Accents: blue-600 (Data/Signal), amber-500 (Clock/Power), emerald-500 (Success/Logic) */

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8fafc; /* slate-50 */
            color: #1e293b; /* slate-800 */
        }

        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            height: 300px;
            max-height: 400px;
        }

        /* Bus Lines for Architecture Diagram */
        .bus-line-vertical {
            width: 4px;
            background-color: #94a3b8; /* slate-400 */
            margin: 0 auto;
        }
        .bus-line-horizontal {
            height: 4px;
            background-color: #94a3b8;
            width: 100%;
        }
        
        /* Interactive Element States */
        .interactive-card {
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }
        .interactive-card:hover {
            transform: translateX(4px);
            border-left-color: #2563eb; /* blue-600 */
        }
        .active-card {
            background-color: #e0f2fe; /* sky-100 */
            border-left-color: #0284c7; /* sky-600 */
        }

        /* FSM State Nodes */
        .fsm-node {
            transition: all 0.4s ease;
        }
        .fsm-active {
            background-color: #22c55e; /* green-500 */
            color: white;
            box-shadow: 0 0 15px rgba(34, 197, 94, 0.5);
            transform: scale(1.05);
        }
    </style>
    <!-- Application Structure Plan:
        1. Header: Introduction to the project context (VHDL -> Hardware).
        2. "The Abstract Logic" (FSM Simulator): Users interact with the Vending Machine logic directly to understand the 'Behavioral' code.
        3. "The Physical Mapping" (Translation Layer): Interactive comparison between VHDL syntax and physical components (FPGA, LUTs, Registers).
        4. "The Architecture" (Block Diagram): A CSS-built visual representation of the internal datapath and control unit, showing how data flows.
        5. "The Timing" (Waveform Simulation): Chart.js visualization of the testbench signals, treating time as the X-axis.
    -->
    <!-- Visualization & Content Choices:
        - FSM Simulator: Interactive HTML/JS. Goal: Explain the 'process' and state transitions.
        - Mapping List: Clickable list. Goal: Connect abstract code to concrete hardware.
        - Architecture Block Diagram: HTML Grid/Flex. Goal: Visualize the SoC structure without SVG.
        - Waveform Chart: Chart.js Stepped Line. Goal: Visualize digital signals (clk, inputs, outputs) over time (ns).
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="antialiased">

    <!-- Header Section -->
    <header class="bg-white shadow-sm border-b border-slate-200 sticky top-0 z-50">
        <div class="max-w-6xl mx-auto px-4 py-4 flex justify-between items-center">
            <div>
                <h1 class="text-2xl font-bold text-slate-800">Integración VHDL: Del Código al Chip</h1>
                <p class="text-sm text-slate-500">Simulación Interactiva de una Máquina de Refrescos en FPGA</p>
            </div>
            <div class="hidden md:block text-xs text-slate-400">
                Arquitectura de Computadores
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 py-8 space-y-12">

        <!-- Intro Text -->
        <section class="prose max-w-none text-slate-600">
            <p class="text-lg leading-relaxed">
                Este panel interactivo explora cómo un diseño digital descrito en <strong>VHDL</strong> se transforma en componentes físicos dentro de una <strong>FPGA</strong> o SoC.
                A diferencia del software secuencial (C++), el VHDL describe circuitos que operan en paralelo. Utilice las secciones a continuación para simular la lógica,
                explorar el mapeo de hardware y visualizar las señales digitales en el tiempo.
            </p>
        </section>

        <!-- SECTION 1: FSM Simulator -->
        <section id="simulation" class="bg-white rounded-xl shadow-lg border border-slate-200 overflow-hidden">
            <div class="p-6 bg-slate-50 border-b border-slate-200">
                <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">1</span>
                    Simulador de la Unidad de Control (FSM)
                </h2>
                <p class="mt-2 text-sm text-slate-600">
                    Interactúe con la máquina para entender la lógica descrita en el <code>process(ep, boton...)</code>.
                    Observe cómo cambia el estado interno y el registro de memoria (acumulador).
                    <strong>Meta:</strong> Llegar a 30 créditos para obtener el refresco.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 p-8">
                <!-- User Controls -->
                <div class="space-y-6">
                    <div class="bg-slate-100 p-4 rounded-lg">
                        <h3 class="font-semibold mb-3 text-slate-700">Entradas del Usuario (Sensores)</h3>
                        <div class="flex flex-wrap gap-3">
                            <button onclick="insertCoin(10)" class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded shadow transition active:scale-95">
                                Insertar 10
                            </button>
                            <button onclick="insertCoin(20)" class="px-4 py-2 bg-amber-500 hover:bg-amber-600 text-white rounded shadow transition active:scale-95">
                                Insertar 20
                            </button>
                            <button onclick="pressButton()" class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded shadow transition active:scale-95">
                                Botón Compra
                            </button>
                            <button onclick="resetSystem()" class="px-4 py-2 bg-slate-400 hover:bg-slate-500 text-white rounded shadow transition">
                                Reset
                            </button>
                        </div>
                    </div>

                    <div class="bg-slate-800 text-green-400 p-4 rounded-lg font-mono text-sm shadow-inner">
                        <div class="flex justify-between border-b border-slate-700 pb-2 mb-2">
                            <span>REGISTRO 'CANTIDAD':</span>
                            <span id="display-amount" class="font-bold text-xl">00000000</span>
                        </div>
                        <div class="flex justify-between">
                            <span>SALIDA 'REFRESCO':</span>
                            <span id="display-output">0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>SALIDA 'VUELTA':</span>
                            <span id="display-change">00000000</span>
                        </div>
                        <div class="mt-2 text-xs text-slate-500">
                            *Valor Decimal: <span id="display-decimal">0</span>
                        </div>
                    </div>
                </div>

                <!-- Visual State Machine -->
                <div class="relative min-h-[300px] flex flex-col justify-center items-center space-y-8">
                    <!-- Bus representation -->
                    <div class="absolute left-1/2 top-0 bottom-0 w-1 bg-slate-200 -z-10"></div>

                    <!-- States -->
                    <div id="state-almacenamiento" class="fsm-node fsm-active w-48 p-4 rounded border-2 border-slate-300 bg-white text-center shadow-sm">
                        <div class="font-bold">Almacenamiento</div>
                        <div class="text-xs text-slate-500">Espera monedas</div>
                    </div>

                    <div id="state-seleccion" class="fsm-node w-48 p-4 rounded border-2 border-slate-300 bg-white text-center shadow-sm">
                        <div class="font-bold">Selección</div>
                        <div class="text-xs text-slate-500">Verifica Precio (>= 30)</div>
                    </div>

                    <div id="state-expulsion" class="fsm-node w-48 p-4 rounded border-2 border-slate-300 bg-white text-center shadow-sm">
                        <div class="font-bold">Expulsión</div>
                        <div class="text-xs text-slate-500">Entrega y Resetea</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 2: Mapping VHDL to Hardware -->
        <section class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            <div class="lg:col-span-12">
                <h2 class="text-2xl font-bold text-slate-800 mb-2">Mapeo: Código vs. Hardware</h2>
                <p class="text-slate-600 mb-6">
                    Seleccione un elemento de código VHDL a la izquierda para ver qué componente físico se sintetiza en la FPGA.
                </p>
            </div>

            <!-- Left: Code Snippets -->
            <div class="lg:col-span-5 space-y-3">
                <div onclick="showHardware('entity')" class="interactive-card cursor-pointer bg-white p-4 rounded shadow-sm border border-slate-100 hover:bg-slate-50">
                    <code class="text-indigo-600 font-bold text-sm block mb-1">entity refresco port (...)</code>
                    <p class="text-xs text-slate-500">Definición de entradas y salidas del sistema.</p>
                </div>
                <div onclick="showHardware('signal')" class="interactive-card cursor-pointer bg-white p-4 rounded shadow-sm border border-slate-100 hover:bg-slate-50">
                    <code class="text-indigo-600 font-bold text-sm block mb-1">signal cantidad ...</code>
                    <p class="text-xs text-slate-500">Variables internas que cambian con el tiempo.</p>
                </div>
                <div onclick="showHardware('constant')" class="interactive-card cursor-pointer bg-white p-4 rounded shadow-sm border border-slate-100 hover:bg-slate-50">
                    <code class="text-indigo-600 font-bold text-sm block mb-1">constant precio ...</code>
                    <p class="text-xs text-slate-500">Valores fijos definidos en el código.</p>
                </div>
                <div onclick="showHardware('process')" class="interactive-card cursor-pointer bg-white p-4 rounded shadow-sm border border-slate-100 hover:bg-slate-50">
                    <code class="text-indigo-600 font-bold text-sm block mb-1">process(clk) / case</code>
                    <p class="text-xs text-slate-500">Lógica de control y secuencial.</p>
                </div>
                <div onclick="showHardware('alu')" class="interactive-card cursor-pointer bg-white p-4 rounded shadow-sm border border-slate-100 hover:bg-slate-50">
                    <code class="text-indigo-600 font-bold text-sm block mb-1">cantidad + moneda</code>
                    <p class="text-xs text-slate-500">Operaciones matemáticas.</p>
                </div>
            </div>

            <!-- Right: Hardware Explanation -->
            <div class="lg:col-span-7 bg-slate-800 text-white rounded-xl p-8 flex flex-col justify-center min-h-[300px]">
                <div id="hw-display-title" class="text-2xl font-bold text-amber-400 mb-4">Seleccione un elemento</div>
                <div id="hw-display-desc" class="text-slate-300 text-lg leading-relaxed">
                    Haga clic en los bloques de código de la izquierda para revelar la arquitectura física subyacente que se genera dentro del chip.
                </div>
                <div id="hw-display-tech" class="mt-8 pt-6 border-t border-slate-700 grid grid-cols-2 gap-4 hidden">
                    <div>
                        <span class="text-xs text-slate-500 uppercase tracking-wider">Componente Físico</span>
                        <div id="hw-comp-name" class="text-white font-mono mt-1">--</div>
                    </div>
                    <div>
                        <span class="text-xs text-slate-500 uppercase tracking-wider">Función</span>
                        <div id="hw-comp-func" class="text-white mt-1">--</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- SECTION 3: Visual Architecture Datapath -->
        <section class="bg-white rounded-xl shadow-lg border border-slate-200 p-6">
            <h2 class="text-xl font-bold text-slate-800 mb-6 flex items-center gap-2">
                <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">3</span>
                Diagrama de Arquitectura (Datapath)
            </h2>
            <p class="text-slate-600 mb-8 max-w-3xl">
                Este diagrama representa cómo se conectan físicamente los componentes dentro del FPGA. 
                Los datos (monedas) entran por los puertos, se almacenan en registros, se procesan en la ALU y el control decide los estados.
            </p>

            <!-- CSS Grid Diagram -->
            <div class="relative bg-slate-100 border-4 border-slate-300 rounded-lg p-8 max-w-4xl mx-auto">
                <div class="absolute top-0 left-0 bg-slate-300 text-slate-600 px-2 py-1 text-xs font-bold">FPGA / SoC</div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 text-center">
                    
                    <!-- INPUTS -->
                    <div class="flex flex-col justify-center space-y-4">
                        <div class="bg-amber-100 border-2 border-amber-400 p-2 rounded text-sm font-bold text-amber-800">
                            PIN: Botón
                        </div>
                        <div class="bg-amber-100 border-2 border-amber-400 p-2 rounded text-sm font-bold text-amber-800">
                            PIN: Moneda (8-bit)
                        </div>
                    </div>

                    <!-- CORE LOGIC -->
                    <div class="space-y-6 relative">
                        <!-- Control Unit -->
                        <div class="bg-blue-100 border-2 border-blue-500 p-4 rounded shadow-sm">
                            <h4 class="font-bold text-blue-800 text-sm mb-1">Unidad de Control (FSM)</h4>
                            <p class="text-xs text-blue-600">Lógica Combinacional (LUTs)</p>
                            <div class="mt-2 text-xs bg-white p-1 border border-blue-200">
                                Estados: Almacenamiento, Selección, Expulsión
                            </div>
                        </div>

                        <!-- Vertical Bus -->
                        <div class="h-8 w-1 bg-slate-400 mx-auto"></div>

                        <!-- ALU -->
                        <div class="bg-indigo-100 border-2 border-indigo-500 p-4 rounded shadow-sm">
                            <h4 class="font-bold text-indigo-800 text-sm mb-1">ALU (Datapath)</h4>
                            <p class="text-xs text-indigo-600">Sumadores / Comparadores</p>
                            <div class="flex justify-center gap-2 mt-2">
                                <span class="bg-white px-2 py-1 text-xs border rounded font-mono">+</span>
                                <span class="bg-white px-2 py-1 text-xs border rounded font-mono">-</span>
                                <span class="bg-white px-2 py-1 text-xs border rounded font-mono">>=</span>
                            </div>
                        </div>

                        <!-- Vertical Bus -->
                        <div class="h-8 w-1 bg-slate-400 mx-auto"></div>

                         <!-- Memory -->
                         <div class="bg-purple-100 border-2 border-purple-500 p-4 rounded shadow-sm flex justify-between gap-2">
                            <div class="flex-1">
                                <h4 class="font-bold text-purple-800 text-xs mb-1">RAM/Reg</h4>
                                <div class="bg-white text-xs border border-purple-200 p-1">Cantidad</div>
                            </div>
                            <div class="flex-1 opacity-75">
                                <h4 class="font-bold text-slate-600 text-xs mb-1">ROM</h4>
                                <div class="bg-slate-200 text-xs border border-slate-300 p-1">Precio (30)</div>
                            </div>
                        </div>
                    </div>

                    <!-- OUTPUTS -->
                    <div class="flex flex-col justify-center space-y-4">
                        <div class="bg-green-100 border-2 border-green-500 p-2 rounded text-sm font-bold text-green-800">
                            PIN: Refresco
                        </div>
                        <div class="bg-green-100 border-2 border-green-500 p-2 rounded text-sm font-bold text-green-800">
                            PIN: Vuelta (8-bit)
                        </div>
                    </div>
                </div>

                <!-- Bus Lines (Visual) -->
                <div class="hidden md:block absolute top-1/2 left-[20%] w-[15%] h-1 bg-slate-400"></div> <!-- Input to Core -->
                <div class="hidden md:block absolute top-1/2 right-[20%] w-[15%] h-1 bg-slate-400"></div> <!-- Core to Output -->
            </div>
        </section>

        <!-- SECTION 4: Waveform Simulation -->
        <section class="bg-white rounded-xl shadow-lg border border-slate-200 p-6 mb-12">
            <h2 class="text-xl font-bold text-slate-800 mb-2 flex items-center gap-2">
                <span class="bg-blue-600 text-white w-8 h-8 rounded-full flex items-center justify-center text-sm">4</span>
                Análisis de Tiempos (Testbench)
            </h2>
            <p class="text-slate-600 mb-6">
                Visualización del <code>Testbench</code>. Muestra cómo las señales digitales (Reloj, Entradas, Salidas) cambian nanosegundo a nanosegundo.
                El gráfico reproduce la secuencia exacta descrita en el archivo fuente (Moneda 1 -> Espera -> Moneda 2 -> Botón).
            </p>
            
            <div class="chart-container">
                <canvas id="waveformChart"></canvas>
            </div>
            <div class="mt-4 flex justify-center gap-4">
                <button id="playSimBtn" class="bg-slate-800 text-white px-6 py-2 rounded-full hover:bg-slate-700 transition flex items-center gap-2">
                    <span>▶ Reproducir Simulación</span>
                </button>
            </div>
            <div class="mt-2 text-center text-xs text-slate-400">
                Eje X: Tiempo (nanosegundos) | Eje Y: Nivel Lógico / Valor Entero
            </div>
        </section>

    </main>

    <footer class="bg-slate-800 text-slate-400 py-8 mt-12">
        <div class="max-w-6xl mx-auto px-4 text-center text-sm">
            <p>&copy; 2023 Simulación de Arquitectura de Computadores. Generado basado en el informe VHDL.</p>
        </div>
    </footer>

    <script>
        // --- 1. FSM Simulator Logic ---
        const STATE = {
            ALMACENAMIENTO: 'almacenamiento',
            SELECCION: 'seleccion',
            EXPULSION: 'expulsion'
        };

        const PRECIO = 30;
        let currentState = STATE.ALMACENAMIENTO;
        let cantidad = 0; // Accumulator
        
        function updateUI() {
            // Update Decimal Display
            document.getElementById('display-decimal').innerText = cantidad;
            
            // Update Binary Display (8-bit)
            let binary = cantidad.toString(2).padStart(8, '0');
            document.getElementById('display-amount').innerText = binary;

            // Visual State Highlight
            document.querySelectorAll('.fsm-node').forEach(el => {
                el.classList.remove('fsm-active');
            });
            document.getElementById(`state-${currentState}`).classList.add('fsm-active');

            // Handle Outputs based on state
            if (currentState === STATE.EXPULSION) {
                document.getElementById('display-output').innerText = '1 (ENTREGADO)';
                document.getElementById('display-output').classList.add('text-green-400', 'font-bold');
                
                // Calculate Change if any, though logic resets immediately in next clock
                // In this sim, we show it briefly
                let vuelta = Math.max(0, cantidad - PRECIO); // Just for display context, logic handled in transition
                document.getElementById('display-change').innerText = vuelta.toString(2).padStart(8, '0');
            } else {
                document.getElementById('display-output').innerText = '0';
                document.getElementById('display-output').classList.remove('text-green-400', 'font-bold');
                document.getElementById('display-change').innerText = "00000000";
            }
        }

        function insertCoin(val) {
            if (currentState !== STATE.ALMACENAMIENTO) {
                alert("Espere a que termine la operación actual.");
                return;
            }
            cantidad += val;
            // Cap at 255 for 8-bit simulation
            if (cantidad > 255) cantidad = 255;
            updateUI();
        }

        function pressButton() {
            if (currentState === STATE.ALMACENAMIENTO) {
                currentState = STATE.SELECCION;
                updateUI();
                
                // Simulate Clock Cycle delay for checking logic
                setTimeout(() => {
                    checkPrice();
                }, 1000);
            }
        }

        function checkPrice() {
            if (cantidad >= PRECIO) {
                // Change calculation happens here in hardware
                currentState = STATE.EXPULSION;
                updateUI();
                
                // Reset after delivery
                setTimeout(() => {
                    resetSystem();
                }, 2000);
            } else {
                alert("Dinero insuficiente. Se necesitan 30 créditos.");
                currentState = STATE.ALMACENAMIENTO;
                updateUI();
            }
        }

        function resetSystem() {
            currentState = STATE.ALMACENAMIENTO;
            cantidad = 0;
            updateUI();
        }

        // Initialize UI
        updateUI();


        // --- 2. Hardware Mapping Logic ---
        const hwData = {
            'entity': {
                title: 'Pines Físicos de E/S',
                func: 'Interfaz con el mundo exterior. Se conectan a botones, sensores de monedas y motores.',
                tech: 'Buffers de Entrada/Salida'
            },
            'signal': {
                title: 'Registros (Flip-Flops)',
                func: 'Memoria temporal. Mantiene el estado del sistema y el valor acumulado sincronizado con el reloj.',
                tech: 'Flip-Flops tipo D / RAM Distribuida'
            },
            'constant': {
                title: 'Lógica Cableada (ROM)',
                func: 'Almacenamiento de datos fijos (Precio = 30). No gasta memoria dinámica, se conecta a VCC/GND.',
                tech: 'Hardwired Logic'
            },
            'process': {
                title: 'Red de Lógica Combinacional',
                func: 'Decodifica el estado actual y las entradas para decidir el siguiente paso (FSM).',
                tech: 'LUTs (Look-Up Tables)'
            },
            'alu': {
                title: 'Circuitos Aritméticos',
                func: 'Realiza sumas, restas y comparaciones de magnitud en tiempo real.',
                tech: 'Sumadores Completos / Comparadores'
            }
        };

        function showHardware(key) {
            const data = hwData[key];
            const titleEl = document.getElementById('hw-display-title');
            const descEl = document.getElementById('hw-display-desc');
            const techDiv = document.getElementById('hw-display-tech');
            const compName = document.getElementById('hw-comp-name');
            const compFunc = document.getElementById('hw-comp-func');

            // Animation Reset
            titleEl.style.opacity = 0;
            descEl.style.opacity = 0;
            techDiv.style.opacity = 0;

            setTimeout(() => {
                titleEl.innerText = data.title;
                titleEl.className = "text-2xl font-bold text-white mb-4"; // Reset color
                descEl.innerText = data.func;
                
                techDiv.classList.remove('hidden');
                compName.innerText = data.tech;
                compFunc.innerText = "Implementación FPGA";
                
                titleEl.style.opacity = 1;
                descEl.style.opacity = 1;
                techDiv.style.opacity = 1;
            }, 200);

            // Highlight active card
            document.querySelectorAll('.interactive-card').forEach(c => c.classList.remove('active-card'));
            // Since onclick is inline, we rely on the click target. 
            // In a real app we'd bind properly, here we just trust the user click flow or add ID.
            // Simplified for this demo: finding the element that matches text content roughly or via ID would be robust, 
            // but for this snippet we'll skip complex DOM traversal for simplicity.
        }


        // --- 3. Chart.js Waveform Logic ---
        const ctx = document.getElementById('waveformChart').getContext('2d');
        
        // Data derived from Testbench Logic:
        // 0-20ns: Wait
        // 20-30ns: Coin 1 (20) -> Moneda_ins = 1
        // 30-40ns: Wait -> Moneda_ins = 0
        // 40-50ns: Coin 2 (20) -> Moneda_ins = 1
        // 50-60ns: Wait -> Moneda_ins = 0
        // 60-80ns: Button Press -> Boton = 1
        // 80+ns: Release
        
        const labels = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];
        
        // Signals
        const dataClk =     [0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0]; // Toggle every 10ns
        const dataMonedaIns=[0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0];
        const dataBoton =   [0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0];
        const dataCantidad= [0, 0, 0, 20, 20, 40, 40, 40, 10, 0, 0]; // Accumulator logic approximation
        const dataRefresco= [0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0];

        const waveformChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: labels,
                datasets: [
                    {
                        label: 'CLK (Reloj)',
                        data: dataClk,
                        borderColor: '#94a3b8', // Slate 400
                        borderWidth: 1,
                        stepped: true,
                        yAxisID: 'yLogic'
                    },
                    {
                        label: 'Moneda_Insertada (Signal)',
                        data: dataMonedaIns,
                        borderColor: '#f59e0b', // Amber 500
                        borderWidth: 2,
                        stepped: true,
                        yAxisID: 'yLogic'
                    },
                    {
                        label: 'Botón (Input)',
                        data: dataBoton,
                        borderColor: '#6366f1', // Indigo 500
                        borderWidth: 2,
                        stepped: true,
                        yAxisID: 'yLogic'
                    },
                    {
                        label: 'Refresco (Output)',
                        data: dataRefresco,
                        borderColor: '#22c55e', // Green 500
                        backgroundColor: 'rgba(34, 197, 94, 0.2)',
                        fill: true,
                        borderWidth: 2,
                        stepped: true,
                        yAxisID: 'yLogic'
                    },
                    {
                        label: 'Registro Cantidad (Valor Decimal)',
                        data: dataCantidad,
                        borderColor: '#0f172a', // Slate 900
                        borderDash: [5, 5],
                        borderWidth: 2,
                        stepped: true,
                        yAxisID: 'yValue',
                        hidden: false
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: {
                    intersect: false,
                    mode: 'index',
                },
                scales: {
                    x: {
                        title: { display: true, text: 'Tiempo (nanosegundos)' }
                    },
                    yLogic: {
                        type: 'linear',
                        display: true,
                        position: 'left',
                        min: 0,
                        max: 1.5,
                        ticks: { stepSize: 1, callback: function(val) { return val === 0 ? 'LOW' : (val === 1 ? 'HIGH' : ''); } },
                        title: { display: true, text: 'Nivel Lógico' }
                    },
                    yValue: {
                        type: 'linear',
                        display: true,
                        position: 'right',
                        min: 0,
                        max: 50,
                        grid: { drawOnChartArea: false },
                        title: { display: true, text: 'Valor Acumulado' }
                    }
                },
                plugins: {
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                return context.dataset.label + ': ' + context.raw;
                            }
                        }
                    }
                }
            }
        });

        // Animation for chart
        document.getElementById('playSimBtn').addEventListener('click', () => {
            waveformChart.reset();
            waveformChart.update('active');
        });

    </script>
</body>
</html>